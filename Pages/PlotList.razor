
@page "/PlotList"
@inject IJSRuntime JSRuntime;
@inject HttpClient _HttpClient;
@using Newtonsoft.Json;

<style>
    th {
        background-color: #6571ff !important;
        color: white !important;
    }
</style>

<div class="modal fade bd-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="modal-header">
                <h6 class="modal-title h4" id="myLargeModalLabel">Plot Booking Request  At Date :@bookingModel.Bookingdate</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="btn-close">
                </button>
            </div>
            <div class="modal-body">
                <div class="card rounded">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <h6 class="card-title mb-0">Detail</h6>

                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Full Name</label>
                                    <p class="text-muted">@bookingModel.FullName</p>
                                </div>
                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">CNIC:</label>
                                    <p class="text-muted">@bookingModel.CNIC</p>
                                </div>

                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">PassPort No:</label>
                                    <p class="text-muted">@bookingModel.PassPortNo</p>
                                </div>
                            

                            
                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Preferred Plot Size</label>
                                    <p class="text-muted">@bookingModel.PreferredPlotSize</p>
                                </div>

                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Investment Type</label>
                                    <p class="text-muted">@bookingModel.Investmenttype</p>
                                </div>

                                


                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">UtilityDemand</label>
                                    <p class="text-muted">@bookingModel.UtilityDemand</p>
                                </div>

                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Company Name</label>
                                    <p class="text-muted">@bookingModel.CompanyName</p>
                                </div>

                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Company Phone</label>
                                    <p class="text-muted">@bookingModel.CompanyPhoneNo</p>
                                </div>

                             
                            </div>

                            <div class="col-md-4">

                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Father Name:</label>
                                    <p class="text-muted">@bookingModel.FatherName</p>
                                </div>
                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Email ID:</label>
                                    <p class="text-muted">@bookingModel.EmailID</p>
                                </div>
                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase"> NTN No</label>
                                    <p class="text-muted">@bookingModel.NTNNo</p>
                                </div>
                              

                              
                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">type Of Industry</label>
                                    <p class="text-muted">@bookingModel.TypeOfIndustry</p>
                                </div>

                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Payment Option</label>
                                    <p class="text-muted">@bookingModel.PaymentOption</p>
                                </div>


                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Gass Supply Requirments</label>
                                    <p class="text-muted">@bookingModel.GasSupplyRequirments</p>
                                </div>

                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Company Address</label>
                                    <p class="text-muted">@bookingModel.CompanyAddress</p>
                                </div>

                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Company Fax</label>
                                    <p class="text-muted"> @bookingModel.CompanyFaxNo</p>
                                </div>

                                
                            </div>

                            <div class="col-md-4">
                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Contact 1</label>
                                    <p class="text-muted">@bookingModel.Contact1</p>
                                </div>

                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Contact 2</label>
                                    <p class="text-muted">@bookingModel.Contact2</p>
                                </div>
                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">WhatsAppNo</label>
                                    <p class="text-muted">@bookingModel.WhatsAppNo</p>
                                </div>

                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Fax No</label>
                                    <p class="text-muted">@bookingModel.FaxNo</p>
                                </div>

                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Skilled</label>
                                    <p class="text-muted">@bookingModel.Skilled</p>
                                </div>

                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Un Skilled</label>
                                    <p class="text-muted">@bookingModel.UnSkilled</p>
                                </div>
                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Business Status</label>
                                    <p class="text-muted">@bookingModel.BusinessStatus</p>
                                </div>
                                <div class="mt-3">
                                    <label class="tx-11 fw-bolder mb-0 text-uppercase">Company Email</label>
                                    <p class="text-muted">@bookingModel.CompanyEmailID</p>
                                </div>
                            </div>

                        </div>
                        <div class="row">
                            Attachments
                            @if (attachments != null && attachments.Count > 0)
                            {
                                <div class="table-responsive pt-3">
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                             
                                                <th>File Name</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>

                                            @foreach (var file in attachments)
                                            {


                                                <tr class="table-primary">
                                                    <td>@file.FileName</td>
                                                    <td>
                                            
                                                        <button id="BtnClear" value="Download" type="button" class="btn btn-outline-success btn-xs" @onclick="@(() => DownloadDbFile(file.FileName))">Download</button>

                                                   </td>
  
                                                </tr>

                                            }

                                        </tbody> 
                                    </table>
                                </div>
                            }
                            </div>



                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<div class="card">
    <div class="card-body">
        <h6 class="card-title">Request List</h6>
        <p class="text-muted mb-3"> <a href="#" target="_blank"> SIDB  </a>Plot Booking Request.</p>
        <div class="table-responsive">
            <table id="dataTableExample" class="table table-sm">
                <thead>
                    <tr>
                        <th>Sr.No</th>
                        <th>Full Name</th>
                        <th>Father Name</th>
                        <th>CNIC</th>
                        <th>PassPort No</th>
                        <th>NTN No</th>
                        <th>Contact No</th>
                        <th>Booking Date</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var obj in List)
                    {
                        <tr>
                            <td>1</td>
                            <td>@obj.FullName</td>
                            <td>@obj.FatherName</td>
                            <td>@obj.CNIC</td>
                            <td>@obj.PassPortNo</td>
                            <td>@obj.NTNNo</td>
                            <td>@obj.Contact1</td>
                            <td>@obj.Bookingdate</td>

                            <td>
                                <button type="button"  @onclick="() => Open(obj.RpId)" class="btn btn-outline-primary btn-xs" data-bs-toggle="modal" data-bs-target=".bd-example-modal-lg">Detail</button>
                            </td>
                        </tr>
                    }


                </tbody>
            </table>
        </div>
    </div>
</div>













@code {
    List<BookingModel> List = new List<BookingModel>();
    List<Attachments> attachments;
    BookingModel bookingModel = new BookingModel();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {

    }
    protected override async void OnInitialized()
    {

        try
        {

            await CallAPI();
        }

        catch (Exception ex)
        {

        }


    }

    async Task CallAPI()
    {

        try
        {


            using (var httpClient = new HttpClient())
            {
                using (var response = await _HttpClient.GetAsync($"api/Booking"))
                {
                    string apiResponse = await response.Content.ReadAsStringAsync();
                    List = JsonConvert.DeserializeObject<List<BookingModel>>(apiResponse);

                    StateHasChanged();

                }
            }

        }

        catch (Exception ex)
        {

        }
    }

    public async Task Open(int id)
    {
        bookingModel= List.FirstOrDefault(a => a.RpId == id);

        using (var response = await _HttpClient.GetAsync($"api/FileAttachment/GetAttachment?MasterId="+ bookingModel.RpId+ ""))
        {
            attachments = new List<Attachments>();
            string apiResponse = await response.Content.ReadAsStringAsync();
            attachments = JsonConvert.DeserializeObject<List<Attachments>>(apiResponse);

            StateHasChanged();

        }


        StateHasChanged();
        // hit the database and delete the todo
    }


    protected async Task DownloadDbFile(string FileName)
    {

        try
        {
          
            using (var response = await _HttpClient.GetAsync($"api/FileAttachment/DownloadAttachment?attachment=" + FileName+ ""))
            {
                Files fi = new Files();
                string apiResponse = await response.Content.ReadAsStringAsync();
                fi = JsonConvert.DeserializeObject<Files>(apiResponse);
                await JSRuntime.InvokeVoidAsync("jsSaveAsFile", FileName, Convert.ToBase64String(fi.FileContent));
                StateHasChanged();

            }


        }
        catch (Exception ex)
        {

        }
    }
}
